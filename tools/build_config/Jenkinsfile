#!groovy

pipeline {
   agent {
      label env.AGENT
   }

   stages {

      stage('Build') {
         steps {
            sh '''
                echo \"load cmake/\$CMAKE_VERSION\"
                echo \" load matlab/\$MATLAB_VERSION\"
                echo \"load gcc/\$GCC_VERSION\"
                ./tools/build_config/build_script.sh
            '''
         }
      }

      stage('Test') {
         steps {
            sh '''
               cd build &&
               ctest
            '''
         }
      }

      stage('Deploy') {
         steps {
            sh 'echo -e "Deploy step..."'
         }
      }
   }

   post {
      always {
         cleanWS()
      }
   }
}
